# ═══════════════════════════════════════════════════════════════════════════
# vAvA_core - Recipe txAdmin
# Framework FiveM modulaire, sécurisé et multilingue
# Version: 1.0.0
# ═══════════════════════════════════════════════════════════════════════════

$engine: 3

name: vAvA_core Framework
version: 1.0.0
author: vAvA
description: |
    Framework FiveM modulaire, sécurisé et multilingue.
    
    Caractéristiques:
    - Système de personnages multi-personnage
    - Économie complète (cash, banque, argent sale)
    - Système de jobs
    - Inventaire
    - Véhicules avec garage
    - Système de logs et sécurité
    - Support multilingue (FR, EN, ES)
    
    Prérequis:
    - Serveur MySQL/MariaDB
    - oxmysql

variables:

    # Database
    dbHost:
        name: Hôte MySQL
        description: Adresse du serveur MySQL
        default: localhost
    dbUsername:
        name: Utilisateur MySQL
        description: Nom d'utilisateur MySQL
        default: root
    dbPassword:
        name: Mot de passe MySQL
        description: Mot de passe MySQL (laisser vide si aucun)
        default: ""
    dbName:
        name: Nom de la base de données
        description: Nom de la base de données à utiliser
        default: vava_core
    
    # Server
    svHostname:
        name: Nom du serveur
        description: Nom affiché dans la liste des serveurs
        default: "vAvA_core | Roleplay"
    svMaxClients:
        name: Nombre max de joueurs
        description: Nombre maximum de joueurs sur le serveur
        default: 32
    svPort:
        name: Port du serveur
        description: Port TCP/UDP du serveur
        default: 30120
    
    # License
    svLicenseKey:
        name: Clé de licence FiveM
        description: Votre clé de licence depuis keymaster.fivem.net
        default: "changeme"

tasks:
    # ═══════════════════════════════════════════════════════════════════════
    # Téléchargement des fichiers serveur CFX
    # ═══════════════════════════════════════════════════════════════════════
    - action: download_github
      dest: ./resources/[cfx-default]
      ref: master
      src: https://github.com/citizenfx/cfx-server-data
      subpath: resources

    # ═══════════════════════════════════════════════════════════════════════
    # Téléchargement de oxmysql (dépendance requise)
    # ═══════════════════════════════════════════════════════════════════════
    - action: download_file
      path: ./tmp/oxmysql.zip
      url: https://github.com/overextended/oxmysql/releases/download/v2.12.0/oxmysql.zip

    - action: unzip
      dest: ./resources/[standalone]
      src: ./tmp/oxmysql.zip

    - action: remove_path
      path: ./tmp

    # ═══════════════════════════════════════════════════════════════════════
    # Téléchargement de vAvA_core depuis GitHub
    # ═══════════════════════════════════════════════════════════════════════
    - action: download_github
      dest: ./resources/[vava]/vAvA_core
      ref: main
      src: https://github.com/Nicolasbriet/vAvA_core

    # ═══════════════════════════════════════════════════════════════════════
    # Configuration du serveur
    # ═══════════════════════════════════════════════════════════════════════
    - action: move_path
      src: ./resources/[vava]/vAvA_core/server.cfg
      dest: ./server.cfg

    # ═══════════════════════════════════════════════════════════════════════
    # Fin de l'installation
    # ═══════════════════════════════════════════════════════════════════════
    - action: waste_time
      seconds: 1

    - action: connect_database
      connection_string: "mysql://{{dbUsername}}:{{dbPassword}}@{{dbHost}}/{{dbName}}?charset=utf8mb4"

    - action: query_database
      file: ./resources/[vava]/vAvA_core/database/sql/init.sql
